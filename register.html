<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register | Revive</title>
  <link rel="stylesheet" href="CSS/style.css">
  <style>
    /* --- GLITCH MODAL OVERLAY --- */
    .modal-overlay {
        display: none;
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.9);
        backdrop-filter: blur(5px);
        z-index: 9999;
        justify-content: center;
        align-items: center;
        font-family: 'Courier New', monospace;
    }

    .modal-content {
        background: #050505;
        border: 2px solid #00f3ff;
        padding: 3rem;
        text-align: center;
        box-shadow: 0 0 20px #00f3ff, inset 0 0 10px #00f3ff;
        position: relative;
        overflow: hidden;
    }

    /* --- COOL GLITCH TEXT --- */
    .glitch-title {
        font-size: 3rem;
        font-weight: bold;
        color: #fff;
        text-transform: uppercase;
        position: relative;
        text-shadow: 0.05em 0 0 #ff0055, -0.03em -0.04em 0 #00f3ff;
        animation: glitch 500ms infinite;
    }

    .status-text {
        color: #00f3ff;
        margin: 20px 0;
        letter-spacing: 3px;
        animation: blink 0.5s infinite;
    }

    .glitch-btn {
        background: transparent;
        color: #00f3ff;
        border: 1px solid #00f3ff;
        padding: 15px 30px;
        cursor: pointer;
        font-weight: bold;
        transition: 0.3s;
        text-transform: uppercase;
    }

    .glitch-btn:hover {
        background: #00f3ff;
        color: #000;
        box-shadow: 0 0 30px #00f3ff;
    }

    /* --- ANIMATIONS --- */
    @keyframes glitch {
        0% { transform: translate(0); text-shadow: 0.05em 0 0 #ff0055, -0.03em -0.04em 0 #00f3ff; }
        25% { transform: translate(-2px, 2px); }
        50% { transform: translate(2px, -2px); text-shadow: -0.05em -0.025em 0 #ff0055, 0.025em 0.035em 0 #00f3ff; }
        100% { transform: translate(0); }
    }

    @keyframes blink { 50% { opacity: 0; } }
  </style>
</head>
<body>

<header class="banner">
  <div class="scanline"></div> 
  <div class="logo-container">
    <a href="index.html"><img src="Images/logo2.png" alt="Revive Logo"></a>
  </div>
  <nav class="button-group">
    <a href="index.html" class="btn btn-gaming">Home</a>
    <a href="missions.html" class="btn btn-gaming">Missions</a>
  </nav>
</header>

<section class="hero">
  <div class="hero-header">
    <h1 class="glitch-text">Join Mission</h1>
    <p class="status-blink">>> SECURE ENCRYPTED CHANNEL // DATA ENTRY REQUIRED</p>
  </div>

  <form id="registration-form" class="mission-form">
    <div class="input-group">
        <label for="username">[ PLAYER_NAME ]</label>
        <input type="text" id="username" name="username" placeholder="IDENTIFY YOURSELF..." required>
    </div>

    <div class="input-group">
        <label for="email">[ CONTACT_COMMS ]</label>
        <input type="email" id="email" name="email" placeholder="EMAIL@PROTOCOL.COM" required>
    </div>

    <div class="input-group">
        <div class="flex-row">
            <div style="flex: 1;">
                <label for="age">[ AGE ]</label>
                <input type="number" id="age" name="age" placeholder="##" required>
            </div>
            <div style="flex: 2;">
                <label for="mobile">[ MOBILE_FREQ ]</label>
                <input type="tel" id="mobile" name="mobile" placeholder="01XXXXXXXXX" maxlength="11" oninput="this.value = this.value.replace(/[^0-9]/g, '');" required>
            </div>
        </div>
    </div>

    <div class="input-group">
        <label for="location">[ CURRENT_COORDINATES ]</label>
        <input type="text" id="location" name="location" placeholder="CITY / REGION / HQ" required>
    </div>

    <div class="input-group">
        <label for="reason">[ MISSION_MOTIVATION ]</label>
        <textarea id="reason" name="reason" rows="4" placeholder="STATE YOUR OBJECTIVES..." required></textarea>
    </div>

    <button type="submit" id="submit-btn" class="btn btn-action" style="width: 100%;">INITIALIZE_REGISTRATION</button>
  </form>
</section>

<div id="glitch-modal" class="modal-overlay">
    <div class="modal-content">
        <h2 class="glitch-title">ACCESS GRANTED</h2>
        <p class="status-text">MAINFRAME_SYNC: 100% COMPLETE</p>
        <button onclick="closeModal()" class="glitch-btn">RETURN TO INTERFACE</button>
    </div>
</div>

<footer class="footer-hud">
    <div class="footer-container">
        <p class="copyright">&copy; 2025 REVIVE TACTICAL. ALL RIGHTS RESERVED.</p>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    const _supabase = supabase.createClient(
        'https://whcklexzbxyylbiuwtcp.supabase.co', 
        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndoY2tsZXh6Ynh5eWxiaXV3dGNwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyODgwMTgsImV4cCI6MjA4MTg2NDAxOH0.HnnpiGOPgPZHN6WzGYnwkD6BErHj1BsMFjGaruvwXf4'
    );

    const form = document.getElementById('registration-form');
    const btn = document.getElementById('submit-btn');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        btn.innerText = "UPLOADING...";
        btn.disabled = true;

        const formData = new FormData(form);
        const userData = Object.fromEntries(formData);

        try {
            const { error } = await _supabase.from('users').insert([userData]);
            if (error) throw error;

            // SHOW GLITCH POPUP
            document.getElementById('glitch-modal').style.display = 'flex';
            form.reset();
        } catch (error) {
            console.error(error);
            btn.innerText = "SYSTEM_FAILURE";
        } finally {
            btn.disabled = false;
        }
    });

    function closeModal() {
        document.getElementById('glitch-modal').style.display = 'none';
        window.location.href = "index.html";
    }
</script>
</body>
</html>