<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register | Revive</title>
  <link rel="stylesheet" href="CSS/style.css">
</head>
<body>

<header class="banner">
  <div class="scanline"></div> 
  <div class="logo-container">
    <a href="index.html">
        <img src="Images/logo2.png" alt="Revive Logo">
    </a>
  </div>
  <nav class="button-group">
    <a href="index.html" class="btn btn-gaming">Home</a>
    <a href="missions.html" class="btn btn-gaming">Missions</a>
  </nav>
</header>

<section class="hero">
  <div class="hero-header">
    <h1 class="glitch-text">Join Mission</h1>
    <p class="status-blink">>> SECURE ENCRYPTED CHANNEL // DATA ENTRY REQUIRED</p>
  </div>

  <form id="registration-form" class="mission-form">
    
    <div class="input-group">
        <label for="username">[ PLAYER_NAME ]</label>
        <input type="text" id="username" name="username" placeholder="IDENTIFY YOURSELF..." required>
    </div>

    <div class="input-group">
        <label for="email">[ CONTACT_COMMS ]</label>
        <input type="email" id="email" name="email" placeholder="EMAIL@PROTOCOL.COM" required>
    </div>

    <div class="input-group">
        <div class="flex-row">
            <div style="flex: 1;">
                <label for="age">[ AGE ]</label>
                <input type="number" id="age" name="age" placeholder="##" required>
            </div>
            <div style="flex: 2;">
                <label for="mobile">[ MOBILE_FREQ ]</label>
                <input 
                    type="tel" 
                    id="mobile" 
                    name="mobile" 
                    placeholder="01XXXXXXXXX" 
                    inputmode="numeric" 
                    maxlength="11"
                    oninput="this.value = this.value.replace(/[^0-9]/g, '');" 
                    required>
            </div>
        </div>
    </div>

    <div class="input-group">
        <label for="location">[ CURRENT_COORDINATES ]</label>
        <input type="text" id="location" name="location" placeholder="CITY / REGION / HQ" required>
    </div>

    <div class="input-group">
        <label for="reason">[ MISSION_MOTIVATION ]</label>
        <textarea id="reason" name="reason" rows="4" placeholder="STATE YOUR OBJECTIVES..." required></textarea>
    </div>

    <button type="submit" id="submit-btn" class="btn btn-action" style="width: 100%;">INITIALIZE_REGISTRATION</button>

</form>
</section>

<footer class="footer-hud">
    <div class="scanline"></div> 
    
    <div class="footer-container">
        <div class="footer-section">
            <div class="contact-links">
                <a href="tel:+201000000000" class="contact-item">
                    <img src="https://cdn-icons-png.flaticon.com/512/724/724664.png" alt="Phone Icon">
                    <span>+20 1XX XXX XXXX</span>
                </a>
                <a href="https://instagram.com/yourpage" target="_blank" class="contact-item">
                    <img src="https://cdn-icons-png.flaticon.com/512/2111/2111463.png" alt="Instagram Icon">
                    <span>@REVIVE_OFFICIAL</span>
                </a>
            </div>
        </div>

        <div class="footer-section credits">
            <p class="dev-tag">System Developed By:</p>
            <p class="names">
                <a href="https://instagram.com/yehia_hany_profile" target="_blank" class="glitch-link">Yehia Hany Hassan</a>
                <span class="separator">//</span>
                <a href="https://instagram.com/abdelrahman_saeed_profile" target="_blank" class="glitch-link">Abdelrahman Saeed</a>
            </p>
            <p class="copyright">&copy; 2025 REVIVE TACTICAL. ALL RIGHTS RESERVED.</p>
        </div>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
    // INITIALIZE MAINFRAME
    const _supabase = supabase.createClient(
        'https://whcklexzbxyylbiuwtcp.supabase.co', 
        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndoY2tsZXh6Ynh5eWxiaXV3dGNwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyODgwMTgsImV4cCI6MjA4MTg2NDAxOH0.HnnpiGOPgPZHN6WzGYnwkD6BErHj1BsMFjGaruvwXf4'
    );

    const form = document.getElementById('registration-form');
    const btn = document.getElementById('submit-btn');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        btn.innerText = "UPLOADING_TO_MAINFRAME...";
        btn.disabled = true;

        const formData = new FormData(form);
        const userData = Object.fromEntries(formData);

        try {
            // DIRECT INSERT TO SUPABASE
            const { error } = await _supabase
                .from('users')
                .insert([userData], { returning: 'minimal' });

            if (error) throw error;

            // SUCCESS: SHOW GLITCH MODAL
            document.getElementById('glitch-modal').style.display = 'flex';
            form.reset();
            btn.innerText = "INITIALIZE_REGISTRATION";

        } catch (error) {
            console.error("CRITICAL_FAILURE:", error.message);
            btn.innerText = "SYSTEM_FAILURE";
            btn.style.backgroundColor = "#ff0055";
            alert("DB_SYNC_ERROR: Check RLS Policies.");
        } finally {
            btn.disabled = false;
        }
    });

    function closeModal() {
        document.getElementById('glitch-modal').style.display = 'none';
        window.location.href = "index.html";
    }
</script>
<div id="glitch-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="glitch-title">ACCESS GRANTED</h2>
            <p class="status-text">MAINFRAME_SYNC: 100% COMPLETE</p>
            <button onclick="closeModal()" class="glitch-btn">RETURN TO INTERFACE</button>
        </div>
    </div>

    <style>
        .modal-overlay {
            display: none; /* This makes the text disappear until needed */
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }
        /* ... add the rest of the CSS I gave you here ... */
    </style>

    <script>
        function closeModal() {
            document.getElementById('glitch-modal').style.display = 'none';
        }

        // Your existing form submission code goes here
    </script>
</body>
</html>